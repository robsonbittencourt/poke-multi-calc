<div class="container">
  <div class="header">
    <span class="title">Pokémon Multi Calc</span>
  </div>

  <div class="left-pokemon">
    <div class="header-left-pokemon">
      <span class="title-left-pokemon">Attacking pokemon</span>
    </div>
    <div>
      <li class="form-row">
        <label>Pokémon</label>
        <input type="text" placeholder="Choose Pokémon" matInput [formControl]="controlPokemonName"
          [matAutocomplete]="autoPokemon">
        <mat-autocomplete #autoPokemon="matAutocomplete" (optionSelected)="onPokemonSelected($event.option.value)">
          <mat-option *ngFor="let pokemonName of filteredPokemonNames | async" [value]="pokemonName">
            {{pokemonName}}
          </mat-option>
        </mat-autocomplete>
      </li>
      <li class="form-row">
        <label>Nature</label>
        <input type="text" placeholder="Choose Nature" [formControl]="controlNature" [matAutocomplete]="autoNature">
        <mat-autocomplete #autoNature="matAutocomplete" (optionSelected)="onNatureSelected($event.option.value)">
          <mat-option *ngFor="let nature of filteredNatures | async" [value]="nature">
            {{nature}}
          </mat-option>
        </mat-autocomplete>
      </li>
      <li class="form-row">
        <label>Item</label>
        <input type="text" placeholder="Choose Nature" [formControl]="controlItem" [matAutocomplete]="autoItem">
        <mat-autocomplete #autoItem="matAutocomplete" (optionSelected)="onItemSelected($event.option.value)">
          <mat-option *ngFor="let item of filteredItems | async" [value]="item">
            {{item}}
          </mat-option>
        </mat-autocomplete>
      </li>
      <li class="form-row">
        <label>Ability</label>
        <input type="text" placeholder="Choose Ability" [formControl]="controlAbility" [matAutocomplete]="autoAbility">
        <mat-autocomplete #autoAbility="matAutocomplete" (optionSelected)="onAbilitySelected($event.option.value)">
          <mat-option *ngFor="let ability of filteredAbilities | async" [value]="ability">
            {{ability}}
          </mat-option>
        </mat-autocomplete>
      </li>
      <li class="form-row">
        <label>TeraType</label>
        <mat-checkbox [ngModel]="pokemon.teraTypeActive" (change)="pokemon.changeTeraStatus($event.checked)"></mat-checkbox>
        <input type="text" placeholder="Choose Tera Type" [formControl]="controlTeraType"
          [matAutocomplete]="autoTeraType">
        <mat-autocomplete #autoTeraType="matAutocomplete" (optionSelected)="onTeraTypeSelected($event.option.value)">
          <mat-option *ngFor="let teraType of filteredTeraTypes | async" [value]="teraType">
            {{teraType}}
          </mat-option>
        </mat-autocomplete>
      </li>
      <li class="form-row">
        <label>Move</label>
        <input type="text" placeholder="Choose Move" [formControl]="controlMove" [matAutocomplete]="autoMove">
        <mat-autocomplete #autoMove="matAutocomplete" (optionSelected)="onMoveSelected($event.option.value)">
          <mat-option *ngFor="let move of filteredMoves | async" [value]="move">
            {{move}}
          </mat-option>
        </mat-autocomplete>
      </li>
    </div>
    <div class="left-pokemon-evs">
      <div class="ev-value dense-2">
        <mat-form-field appearance="outline" class="mat-ev-field">
          <mat-label>HP</mat-label>
          <input type="number" min="0" max="252" matInput [(ngModel)]="pokemon.evs.hp">
        </mat-form-field>
      </div>
      <div class="ev-slider">
        <mat-slider class="mat-ev-slider" [min]="calculateMin(pokemon.evs.hp)" [max]="252" [step]="calculateEvStep(pokemon.evs.hp)">
          <input matSliderThumb (change)="onChangeEvValue()" [(ngModel)]="pokemon.evs.hp" (input)="beforeChangeEvValue()">
        </mat-slider>
      </div>
      <div class="stat-value">
        <label>{{ pokemon.hp }}</label>
      </div>

      <div class="ev-value dense-2">
        <mat-form-field appearance="outline" class="mat-ev-field">
          <mat-label>ATK</mat-label>
          <input type="number" min="0" max="252" matInput [(ngModel)]="pokemon.evs.atk">
        </mat-form-field>
      </div>
      <div class="ev-slider">
        <mat-slider class="mat-ev-slider" [min]="calculateMin(pokemon.evs.atk)" [max]="252" [step]="calculateEvStep(pokemon.evs.atk)">
          <input matSliderThumb (change)="onChangeEvValue()" [(ngModel)]="pokemon.evs.atk" (input)="beforeChangeEvValue()">
        </mat-slider>
      </div>
      <div class="stat-value">
        <label>{{ pokemon.atk }}</label>
      </div>

      <div class="ev-value dense-2">
        <mat-form-field appearance="outline" class="mat-ev-field">
          <mat-label>DEF</mat-label>
          <input type="number" min="0" max="252" matInput [(ngModel)]="pokemon.evs.def">
        </mat-form-field>
      </div>
      <div class="ev-slider">
        <mat-slider class="mat-ev-slider" [min]="calculateMin(pokemon.evs.def)" [max]="252" [step]="calculateEvStep(pokemon.evs.def)">
          <input matSliderThumb (change)="onChangeEvValue()" [(ngModel)]="pokemon.evs.def" (input)="beforeChangeEvValue()">
        </mat-slider>
      </div>
      <div class="stat-value">
        <label>{{ pokemon.def }}</label>
      </div>

      <div class="ev-value dense-2">
        <mat-form-field appearance="outline" class="mat-ev-field">
          <mat-label>SPA</mat-label>
          <input type="number" min="0" max="252" matInput [(ngModel)]="pokemon.evs.spa">
        </mat-form-field>
      </div>
      <div class="ev-slider">
        <mat-slider class="mat-ev-slider" [min]="calculateMin(pokemon.evs.spa)" [max]="252" [step]="calculateEvStep(pokemon.evs.spa)">
          <input matSliderThumb (change)="onChangeEvValue()" [(ngModel)]="pokemon.evs.spa" (input)="beforeChangeEvValue()">
        </mat-slider>
      </div>
      <div class="stat-value">
        <label>{{ pokemon.spa }}</label>
      </div>

      <div class="ev-value dense-2">
        <mat-form-field appearance="outline" class="mat-ev-field">
          <mat-label>SPD</mat-label>
          <input type="number" min="0" max="252" matInput [(ngModel)]="pokemon.evs.spd">
        </mat-form-field>
      </div>
      <div class="ev-slider">
        <mat-slider class="mat-ev-slider" [min]="calculateMin(pokemon.evs.spd)" [max]="252" [step]="calculateEvStep(pokemon.evs.spd)">
          <input matSliderThumb (change)="onChangeEvValue()" [(ngModel)]="pokemon.evs.spd" (input)="beforeChangeEvValue()">
        </mat-slider>
      </div>
      <div class="stat-value">
        <label>{{ pokemon.spd }}</label>
      </div>

      <div class="ev-value dense-2">
        <mat-form-field appearance="outline" class="mat-ev-field">
          <mat-label>SPE</mat-label>
          <input type="number" min="0" max="252" matInput [(ngModel)]="pokemon.evs.spe">
        </mat-form-field>
      </div>
      <div class="ev-slider">
        <mat-slider class="mat-ev-slider" [min]="calculateMin(pokemon.evs.spe)" [max]="252" [step]="calculateEvStep(pokemon.evs.spe)">
          <input matSliderThumb (change)="onChangeEvValue()" [(ngModel)]="pokemon.evs.spe" (input)="beforeChangeEvValue()">
        </mat-slider>
      </div>
      <div class="stat-value">
        <label>{{ pokemon.spe }}</label>
      </div>
    </div>
    <div class="remaining-evs">
      <label>Remaining: {{ MAX_EVS - pokemon.totalEvs() }}</label>
    </div>
    <div class="left-pokemon-buttons">
      <button mat-flat-button color="primary" (click)="addPokemon()" class="mat-flat-button">Add as defender</button>
      <button mat-flat-button color="primary" (click)="addFromPokePaste()" class="mat-flat-button">Add from Paste</button>
    </div>
    <div class="pokepaste-input">
      <li class="form-row">
        <label>Paste Link</label>
        <input type="text" matInput [(ngModel)]="pokePaste">
      </li>
    </div>
  </div>

  <div class="field">
    <div class="header-left-pokemon">
      <span class="title-left-pokemon">Field</span>
    </div>
    <div>
      <mat-checkbox [(ngModel)]="field.tabletsOfRuinActive"></mat-checkbox>Tablets Of Ruin (-atk)
    </div>
    <div>
      <mat-checkbox [(ngModel)]="field.swordOfRuinActive"></mat-checkbox>Sword Of Ruin Active (-def)
    </div>
    <div>
      <mat-checkbox [(ngModel)]="field.vesselOfRuinActive"></mat-checkbox>Vessel Of Ruin (-spa)
    </div>
    <div>
      <mat-checkbox [(ngModel)]="field.beadsOfRuinActive"></mat-checkbox>Beads Of Ruin (-spd)
    </div>
  </div>

  <div class="header-damage-result">
    <label class="title-left-pokemon">Result</label>
    <label class="subtitle">Use Add as defender button to add more Pokémon</label>
  </div>
  <div class="target-pokemon">
    <div *ngFor="let target of targets; let myIndex=index;">
      <mat-card class="card" [ngStyle]="{'background-color': cardColor(target.koChance)}">
        <mat-card-title-group>
          <mat-card-title>{{ target.name }}</mat-card-title>
          <mat-card-subtitle>Item: {{ target.item }}</mat-card-subtitle>
          <mat-card-subtitle>Nature: {{ target.nature }}</mat-card-subtitle>
          <mat-card-subtitle>Ability: {{ target.ability }}</mat-card-subtitle>
          <mat-card-subtitle>{{ target.evsDescription() }}</mat-card-subtitle>
          <mat-card-subtitle *ngIf="target.teraTypeActive()">Terastalyzed as {{ target.teraType }} type
          </mat-card-subtitle>
          <img mat-card-md-image src='https://img.pokemondb.net/sprites/home/normal/{{target.lowerCaseName}}.png'>
        </mat-card-title-group>
        <div class="card-container">
          <div class="card-content">
            <br>Damage: {{ target.result }}
            <br>{{ target.koChance }}
          </div>
          <div class="card-button">
            <button class="icon-button" (click)="terastalyzePokemon(myIndex)" *ngIf="target.teraTypeStorage">
              <img class="icon" src="assets/icons/tera-icon.png" *ngIf="target.teraTypeActive()"/>
              <img class="icon" src="assets/icons/tera-icon-gray.png" *ngIf="!target.teraTypeActive()" />
            </button>
            <a (click)="removePokemon(myIndex)">
              <mat-icon fontIcon="delete"></mat-icon>
            </a>
          </div>
        </div>
      </mat-card>
    </div>
  </div>
  <div class="remove-all-section">
    <button mat-flat-button color="primary" (click)="removeAll()" class="mat-flat-button">Remove all</button>
  </div>

</div>